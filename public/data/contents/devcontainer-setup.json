{
  "content": "<h3>VS Code Dev Containerで統一された開発環境を構築する方法</h3>\n<p>開発チームで「私の環境では動くのに...」という問題に直面したことはありませんか？Dev Containerを使用すれば、チーム全体で完全に統一された開発環境を構築でき、セットアップも数分で完了します。</p>\n<h3>1. Dev Containerとは？</h3>\n<p>Dev Container（Development Container）は、VS CodeとDockerを組み合わせて、コンテナ化された開発環境を提供する仕組みです。</p>\n<p><strong>主な利点：</strong></p>\n<ul>\n<li><strong>環境の統一</strong>: チーム全員が同じ開発環境で作業</li>\n<li><strong>迅速なセットアップ</strong>: 新メンバーも数分で開発開始可能</li>\n<li><strong>クリーンな環境</strong>: ホストマシンを汚さない</li>\n<li><strong>再現性</strong>: 本番環境に近い環境で開発</li>\n<li><strong>ツールの共有</strong>: VS Code拡張機能も統一</li>\n</ul>\n<h3>2. 前提条件</h3>\n<p>Dev Containerを使用するには、以下が必要です：</p>\n<ul>\n<li><strong>Visual Studio Code</strong>: 最新版を推奨</li>\n<li><strong>Docker Desktop</strong>: Docker環境が必要\n<ul>\n<li>Windows: Docker Desktop for Windows</li>\n<li>macOS: Docker Desktop for Mac</li>\n<li>Linux: Docker Engine</li>\n</ul>\n</li>\n<li><strong>VS Code拡張機能</strong>: Dev Containers</li>\n</ul>\n<pre><code class=\"language-bash\"># VS Code拡張機能のインストール\ncode --install-extension ms-vscode-remote.remote-containers\n</code></pre>\n<h3>3. 基本的なディレクトリ構造</h3>\n<p>Dev Containerの設定は<code>.devcontainer</code>ディレクトリに配置します：</p>\n<pre><code>project-root/\n  ├── .devcontainer/\n  │   ├── devcontainer.json    # Dev Containerの設定\n  │   ├── Dockerfile           # コンテナイメージの定義\n  │   └── docker-compose.yml   # 複数コンテナの場合（オプション）\n  ├── src/\n  └── package.json\n</code></pre>\n<h3>4. 最小限の設定例</h3>\n<p><strong>React + Node.js開発環境</strong></p>\n<p><strong><code>.devcontainer/devcontainer.json</code></strong></p>\n<pre><code class=\"language-json\">{\n  &quot;name&quot;: &quot;React Dev Container&quot;,\n  &quot;image&quot;: &quot;mcr.microsoft.com/devcontainers/javascript-node:18&quot;,\n  &quot;customizations&quot;: {\n    &quot;vscode&quot;: {\n      &quot;extensions&quot;: [\n        &quot;dbaeumer.vscode-eslint&quot;,\n        &quot;esbenp.prettier-vscode&quot;,\n        &quot;dsznajder.es7-react-js-snippets&quot;\n      ],\n      &quot;settings&quot;: {\n        &quot;editor.defaultFormatter&quot;: &quot;esbenp.prettier-vscode&quot;,\n        &quot;editor.formatOnSave&quot;: true\n      }\n    }\n  },\n  &quot;forwardPorts&quot;: [3000, 5173],\n  &quot;postCreateCommand&quot;: &quot;npm install&quot;\n}\n</code></pre>\n<p>この設定だけで、Node.js 18の環境、必要な拡張機能、ポートフォワーディングが自動設定されます。</p>\n<h3>5. カスタムDockerfileを使用する</h3>\n<p>より細かい制御が必要な場合は、独自のDockerfileを作成します：</p>\n<p><strong><code>.devcontainer/Dockerfile</code></strong></p>\n<pre><code class=\"language-dockerfile\">FROM node:18-bullseye\n\n# システムパッケージの更新とインストール\nRUN apt-get update &amp;&amp; export DEBIAN_FRONTEND=noninteractive \\\n    &amp;&amp; apt-get -y install --no-install-recommends \\\n    git \\\n    curl \\\n    wget \\\n    vim \\\n    &amp;&amp; apt-get clean \\\n    &amp;&amp; rm -rf /var/lib/apt/lists/*\n\n# グローバルにnpmパッケージをインストール\nRUN npm install -g pnpm@latest\n\n# 作業ディレクトリの設定\nWORKDIR /workspace\n\n# ユーザーの作成（オプション、セキュリティ向上のため）\nRUN useradd -m -s /bin/bash developer\nUSER developer\n</code></pre>\n<p><strong><code>.devcontainer/devcontainer.json</code></strong></p>\n<pre><code class=\"language-json\">{\n  &quot;name&quot;: &quot;Custom React Environment&quot;,\n  &quot;build&quot;: {\n    &quot;dockerfile&quot;: &quot;Dockerfile&quot;,\n    &quot;context&quot;: &quot;..&quot;\n  },\n  &quot;customizations&quot;: {\n    &quot;vscode&quot;: {\n      &quot;extensions&quot;: [\n        &quot;dbaeumer.vscode-eslint&quot;,\n        &quot;esbenp.prettier-vscode&quot;,\n        &quot;dsznajder.es7-react-js-snippets&quot;,\n        &quot;bradlc.vscode-tailwindcss&quot;\n      ]\n    }\n  },\n  &quot;forwardPorts&quot;: [3000, 5173],\n  &quot;postCreateCommand&quot;: &quot;pnpm install&quot;,\n  &quot;remoteUser&quot;: &quot;developer&quot;\n}\n</code></pre>\n<h3>6. 複数サービスの構成（Docker Compose）</h3>\n<p>データベースやAPIサーバーなど、複数のコンテナが必要な場合はDocker Composeを使用します：</p>\n<p><strong><code>.devcontainer/docker-compose.yml</code></strong></p>\n<pre><code class=\"language-yaml\">version: '3.8'\n\nservices:\n  app:\n    build:\n      context: ..\n      dockerfile: .devcontainer/Dockerfile\n    volumes:\n      - ..:/workspace:cached\n    command: sleep infinity\n    networks:\n      - dev-network\n    depends_on:\n      - db\n      - redis\n\n  db:\n    image: postgres:15\n    restart: unless-stopped\n    volumes:\n      - postgres-data:/var/lib/postgresql/data\n    environment:\n      POSTGRES_USER: developer\n      POSTGRES_PASSWORD: password\n      POSTGRES_DB: devdb\n    networks:\n      - dev-network\n    ports:\n      - &quot;5432:5432&quot;\n\n  redis:\n    image: redis:7-alpine\n    restart: unless-stopped\n    networks:\n      - dev-network\n    ports:\n      - &quot;6379:6379&quot;\n\nvolumes:\n  postgres-data:\n\nnetworks:\n  dev-network:\n</code></pre>\n<p><strong><code>.devcontainer/devcontainer.json</code>（Docker Compose使用時）</strong></p>\n<pre><code class=\"language-json\">{\n  &quot;name&quot;: &quot;Full Stack Development&quot;,\n  &quot;dockerComposeFile&quot;: &quot;docker-compose.yml&quot;,\n  &quot;service&quot;: &quot;app&quot;,\n  &quot;workspaceFolder&quot;: &quot;/workspace&quot;,\n  &quot;customizations&quot;: {\n    &quot;vscode&quot;: {\n      &quot;extensions&quot;: [\n        &quot;dbaeumer.vscode-eslint&quot;,\n        &quot;esbenp.prettier-vscode&quot;,\n        &quot;ms-azuretools.vscode-docker&quot;,\n        &quot;mtxr.sqltools&quot;,\n        &quot;mtxr.sqltools-driver-pg&quot;\n      ]\n    }\n  },\n  &quot;forwardPorts&quot;: [3000, 5432, 6379],\n  &quot;postCreateCommand&quot;: &quot;npm install &amp;&amp; npm run db:migrate&quot;\n}\n</code></pre>\n<h3>7. devcontainer.jsonの主要設定項目</h3>\n<p><strong>基本設定：</strong></p>\n<pre><code class=\"language-json\">{\n  // コンテナ名\n  &quot;name&quot;: &quot;My Dev Container&quot;,\n  \n  // 使用するイメージ\n  &quot;image&quot;: &quot;mcr.microsoft.com/devcontainers/typescript-node:18&quot;,\n  \n  // または独自のDockerfile\n  &quot;build&quot;: {\n    &quot;dockerfile&quot;: &quot;Dockerfile&quot;,\n    &quot;args&quot;: {\n      &quot;NODE_VERSION&quot;: &quot;18&quot;\n    }\n  }\n}\n</code></pre>\n<p><strong>ポート転送：</strong></p>\n<pre><code class=\"language-json\">{\n  // ポートの自動転送\n  &quot;forwardPorts&quot;: [3000, 8080],\n  \n  // ポート属性の詳細設定\n  &quot;portsAttributes&quot;: {\n    &quot;3000&quot;: {\n      &quot;label&quot;: &quot;Frontend&quot;,\n      &quot;onAutoForward&quot;: &quot;notify&quot;\n    },\n    &quot;8080&quot;: {\n      &quot;label&quot;: &quot;Backend API&quot;,\n      &quot;onAutoForward&quot;: &quot;openBrowser&quot;\n    }\n  }\n}\n</code></pre>\n<p><strong>ライフサイクルコマンド：</strong></p>\n<pre><code class=\"language-json\">{\n  // コンテナ作成後に1度だけ実行\n  &quot;postCreateCommand&quot;: &quot;npm install&quot;,\n  \n  // コンテナ起動時に毎回実行\n  &quot;postStartCommand&quot;: &quot;npm run dev&quot;,\n  \n  // コンテナアタッチ時に実行\n  &quot;postAttachCommand&quot;: &quot;echo 'Welcome to Dev Container!'&quot;\n}\n</code></pre>\n<p><strong>マウント設定：</strong></p>\n<pre><code class=\"language-json\">{\n  &quot;mounts&quot;: [\n    // SSH鍵をコンテナ内で使用\n    &quot;source=${localEnv:HOME}/.ssh,target=/home/node/.ssh,readonly,type=bind&quot;,\n    \n    // Git設定の共有\n    &quot;source=${localEnv:HOME}/.gitconfig,target=/home/node/.gitconfig,type=bind&quot;\n  ]\n}\n</code></pre>\n<h3>8. VS Code設定とエクステンション</h3>\n<p><strong>チーム全体で統一する拡張機能：</strong></p>\n<pre><code class=\"language-json\">{\n  &quot;customizations&quot;: {\n    &quot;vscode&quot;: {\n      &quot;extensions&quot;: [\n        // 必須拡張機能\n        &quot;dbaeumer.vscode-eslint&quot;,\n        &quot;esbenp.prettier-vscode&quot;,\n        \n        // React開発\n        &quot;dsznajder.es7-react-js-snippets&quot;,\n        &quot;styled-components.vscode-styled-components&quot;,\n        \n        // ユーティリティ\n        &quot;eamodio.gitlens&quot;,\n        &quot;usernamehw.errorlens&quot;,\n        &quot;christian-kohler.path-intellisense&quot;,\n        \n        // テスト\n        &quot;orta.vscode-jest&quot;\n      ],\n      &quot;settings&quot;: {\n        &quot;editor.defaultFormatter&quot;: &quot;esbenp.prettier-vscode&quot;,\n        &quot;editor.formatOnSave&quot;: true,\n        &quot;editor.codeActionsOnSave&quot;: {\n          &quot;source.fixAll.eslint&quot;: true\n        },\n        &quot;eslint.validate&quot;: [\n          &quot;javascript&quot;,\n          &quot;javascriptreact&quot;,\n          &quot;typescript&quot;,\n          &quot;typescriptreact&quot;\n        ]\n      }\n    }\n  }\n}\n</code></pre>\n<h3>9. 環境変数の管理</h3>\n<p><strong>方法1: devcontainer.jsonで設定</strong></p>\n<pre><code class=\"language-json\">{\n  &quot;containerEnv&quot;: {\n    &quot;NODE_ENV&quot;: &quot;development&quot;,\n    &quot;API_URL&quot;: &quot;http://localhost:8080&quot;\n  }\n}\n</code></pre>\n<p><strong>方法2: .envファイルを使用</strong></p>\n<pre><code class=\"language-json\">{\n  &quot;runArgs&quot;: [&quot;--env-file&quot;, &quot;.devcontainer/.env&quot;]\n}\n</code></pre>\n<p><strong><code>.devcontainer/.env</code></strong></p>\n<pre><code class=\"language-env\">NODE_ENV=development\nDATABASE_URL=postgresql://developer:password@db:5432/devdb\nREDIS_URL=redis://redis:6379\n</code></pre>\n<h3>10. パフォーマンス最適化</h3>\n<p><strong>ボリュームマウントの最適化（macOS/Windows）：</strong></p>\n<pre><code class=\"language-json\">{\n  &quot;mounts&quot;: [\n    &quot;source=${localWorkspaceFolder},target=/workspace,type=bind,consistency=cached&quot;\n  ]\n}\n</code></pre>\n<p><strong>node_modulesを名前付きボリュームに（macOS/Windows）：</strong></p>\n<pre><code class=\"language-json\">{\n  &quot;mounts&quot;: [\n    &quot;source=node-modules,target=/workspace/node_modules,type=volume&quot;\n  ]\n}\n</code></pre>\n<h3>11. 実践的な設定例</h3>\n<p><strong>フルスタックReact + Express + PostgreSQL環境：</strong></p>\n<pre><code class=\"language-json\">{\n  &quot;name&quot;: &quot;Full Stack React App&quot;,\n  &quot;dockerComposeFile&quot;: &quot;docker-compose.yml&quot;,\n  &quot;service&quot;: &quot;app&quot;,\n  &quot;workspaceFolder&quot;: &quot;/workspace&quot;,\n  \n  &quot;customizations&quot;: {\n    &quot;vscode&quot;: {\n      &quot;extensions&quot;: [\n        &quot;dbaeumer.vscode-eslint&quot;,\n        &quot;esbenp.prettier-vscode&quot;,\n        &quot;dsznajder.es7-react-js-snippets&quot;,\n        &quot;mtxr.sqltools&quot;,\n        &quot;mtxr.sqltools-driver-pg&quot;,\n        &quot;bradlc.vscode-tailwindcss&quot;,\n        &quot;ms-azuretools.vscode-docker&quot;\n      ],\n      &quot;settings&quot;: {\n        &quot;editor.defaultFormatter&quot;: &quot;esbenp.prettier-vscode&quot;,\n        &quot;editor.formatOnSave&quot;: true,\n        &quot;sqltools.connections&quot;: [\n          {\n            &quot;name&quot;: &quot;Local PostgreSQL&quot;,\n            &quot;driver&quot;: &quot;PostgreSQL&quot;,\n            &quot;server&quot;: &quot;db&quot;,\n            &quot;port&quot;: 5432,\n            &quot;database&quot;: &quot;devdb&quot;,\n            &quot;username&quot;: &quot;developer&quot;,\n            &quot;password&quot;: &quot;password&quot;\n          }\n        ]\n      }\n    }\n  },\n  \n  &quot;forwardPorts&quot;: [3000, 5000, 5432],\n  &quot;portsAttributes&quot;: {\n    &quot;3000&quot;: {\n      &quot;label&quot;: &quot;React Frontend&quot;,\n      &quot;onAutoForward&quot;: &quot;openBrowser&quot;\n    },\n    &quot;5000&quot;: {\n      &quot;label&quot;: &quot;Express API&quot;\n    }\n  },\n  \n  &quot;postCreateCommand&quot;: &quot;npm install &amp;&amp; cd client &amp;&amp; npm install&quot;,\n  &quot;postStartCommand&quot;: &quot;npm run db:migrate&quot;,\n  \n  &quot;features&quot;: {\n    &quot;ghcr.io/devcontainers/features/github-cli:1&quot;: {},\n    &quot;ghcr.io/devcontainers/features/node:1&quot;: {\n      &quot;version&quot;: &quot;18&quot;\n    }\n  }\n}\n</code></pre>\n<h3>12. Dev Container Features</h3>\n<p>Microsoft提供の追加機能を簡単に組み込めます：</p>\n<pre><code class=\"language-json\">{\n  &quot;features&quot;: {\n    // GitHub CLI\n    &quot;ghcr.io/devcontainers/features/github-cli:1&quot;: {},\n    \n    // Docker in Docker\n    &quot;ghcr.io/devcontainers/features/docker-in-docker:2&quot;: {},\n    \n    // AWS CLI\n    &quot;ghcr.io/devcontainers/features/aws-cli:1&quot;: {},\n    \n    // kubectl\n    &quot;ghcr.io/devcontainers/features/kubectl-helm-minikube:1&quot;: {\n      &quot;version&quot;: &quot;latest&quot;\n    }\n  }\n}\n</code></pre>\n<h3>13. トラブルシューティング</h3>\n<p><strong>コンテナが起動しない：</strong></p>\n<pre><code class=\"language-bash\"># Dockerログを確認\ndocker logs &lt;container-id&gt;\n\n# Dev Containerのログを確認\n# VS Code: Command Palette &gt; &quot;Dev Containers: Show Container Log&quot;\n</code></pre>\n<p><strong>ポートが使用中：</strong></p>\n<pre><code class=\"language-json\">{\n  // ホスト側のポートを変更\n  &quot;portsAttributes&quot;: {\n    &quot;3000&quot;: {\n      &quot;hostPort&quot;: 3001  // 別のポートを使用\n    }\n  }\n}\n</code></pre>\n<p><strong>パフォーマンスが遅い（macOS/Windows）：</strong></p>\n<pre><code class=\"language-json\">{\n  // ファイル同期を最適化\n  &quot;mounts&quot;: [\n    &quot;source=${localWorkspaceFolder},target=/workspace,consistency=cached&quot;\n  ],\n  \n  // node_modulesを除外\n  &quot;workspaceMount&quot;: &quot;source=${localWorkspaceFolder},target=/workspace,type=bind,consistency=cached&quot;,\n  &quot;mounts&quot;: [\n    &quot;source=myapp-node-modules,target=/workspace/node_modules,type=volume&quot;\n  ]\n}\n</code></pre>\n<h3>14. ベストプラクティス</h3>\n<ol>\n<li>\n<p><strong>軽量なベースイメージを使用</strong></p>\n<ul>\n<li>Alpine版やslim版を検討</li>\n<li>必要最小限のパッケージのみインストール</li>\n</ul>\n</li>\n<li>\n<p><strong>レイヤーキャッシュを活用</strong></p>\n<ul>\n<li>変更頻度の低い命令を先に記述</li>\n<li>apt-get updateとinstallを1行で実行</li>\n</ul>\n</li>\n<li>\n<p><strong>セキュリティを考慮</strong></p>\n<ul>\n<li>rootユーザーで実行しない</li>\n<li>機密情報は環境変数で管理</li>\n<li>.gitignoreに.envを追加</li>\n</ul>\n</li>\n<li>\n<p><strong>チーム全体で設定を共有</strong></p>\n<ul>\n<li>.devcontainerをGitにコミット</li>\n<li>READMEに使い方を記載</li>\n</ul>\n</li>\n<li>\n<p><strong>バージョンを固定</strong></p>\n<ul>\n<li>Node.jsやパッケージのバージョンを明示</li>\n<li>再現性を確保</li>\n</ul>\n</li>\n</ol>\n<h3>15. CI/CDとの連携</h3>\n<p>Dev Containerの設定はCI環境でも再利用できます：</p>\n<p><strong>GitHub Actions例：</strong></p>\n<pre><code class=\"language-yaml\">name: CI\n\non: [push, pull_request]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    \n    steps:\n      - uses: actions/checkout@v3\n      \n      - name: Build Dev Container\n        uses: devcontainers/ci@v0.3\n        with:\n          runCmd: |\n            npm run test\n            npm run build\n</code></pre>\n<h3>まとめ</h3>\n<p>Dev Containerを使用することで、以下のメリットが得られます：</p>\n<ul>\n<li><strong>一貫性のある開発環境</strong>: 「私の環境では動く」問題を解消</li>\n<li><strong>迅速なオンボーディング</strong>: 新メンバーが即座に開発開始</li>\n<li><strong>クリーンな環境分離</strong>: ホストマシンに依存しない</li>\n<li><strong>チーム全体の生産性向上</strong>: ツールや設定の統一</li>\n</ul>\n<p>特にチーム開発やOSSプロジェクトでは、Dev Containerの導入により開発体験が大幅に向上します。この記事を参考に、ぜひプロジェクトにDev Containerを導入してみてください！</p>\n"
}
